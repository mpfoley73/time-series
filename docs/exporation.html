<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Exploratory Analysis | Time Series Analysis</title>
  <meta name="description" content="Time series analysis using R." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Exploratory Analysis | Time Series Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Time series analysis using R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Exploratory Analysis | Time Series Analysis" />
  
  <meta name="twitter:description" content="Time series analysis using R." />
  

<meta name="author" content="Michael Foley" />


<meta name="date" content="2023-08-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="toolbox.html"/>
<link rel="next" href="regression.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Time Series Analysis in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="toolbox.html"><a href="toolbox.html"><i class="fa fa-check"></i><b>1</b> Toolbox</a>
<ul>
<li class="chapter" data-level="1.1" data-path="toolbox.html"><a href="toolbox.html#r-structures"><i class="fa fa-check"></i><b>1.1</b> R Structures</a>
<ul>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#ts-zoo-and-xts"><i class="fa fa-check"></i>ts, zoo, and xts</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#tsibble"><i class="fa fa-check"></i>tsibble</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="toolbox.html"><a href="toolbox.html#fitting-models"><i class="fa fa-check"></i><b>1.2</b> Fitting Models</a></li>
<li class="chapter" data-level="1.3" data-path="toolbox.html"><a href="toolbox.html#evaluating-models"><i class="fa fa-check"></i><b>1.3</b> Evaluating Models</a></li>
<li class="chapter" data-level="1.4" data-path="toolbox.html"><a href="toolbox.html#evaluating-accuracy"><i class="fa fa-check"></i><b>1.4</b> Evaluating Accuracy</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exporation.html"><a href="exporation.html"><i class="fa fa-check"></i><b>2</b> Exploratory Analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exporation.html"><a href="exporation.html#graphical-analysis"><i class="fa fa-check"></i><b>2.1</b> Graphical Analysis</a></li>
<li class="chapter" data-level="2.2" data-path="exporation.html"><a href="exporation.html#transformations"><i class="fa fa-check"></i><b>2.2</b> Transformations</a></li>
<li class="chapter" data-level="2.3" data-path="exporation.html"><a href="exporation.html#decomposition"><i class="fa fa-check"></i><b>2.3</b> Decomposition</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="exporation.html"><a href="exporation.html#classical-decomposition"><i class="fa fa-check"></i><b>2.3.1</b> Classical Decomposition</a></li>
<li class="chapter" data-level="2.3.2" data-path="exporation.html"><a href="exporation.html#x-11-and-seats"><i class="fa fa-check"></i><b>2.3.2</b> X-11 and SEATS</a></li>
<li class="chapter" data-level="2.3.3" data-path="exporation.html"><a href="exporation.html#stl"><i class="fa fa-check"></i><b>2.3.3</b> STL</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>3</b> Time Series Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="regression.html"><a href="regression.html#exploratory-analysis"><i class="fa fa-check"></i><b>3.1</b> Exploratory Analysis</a></li>
<li class="chapter" data-level="3.2" data-path="regression.html"><a href="regression.html#fit-model"><i class="fa fa-check"></i><b>3.2</b> Fit Model</a>
<ul>
<li class="chapter" data-level="" data-path="regression.html"><a href="regression.html#special-predictors"><i class="fa fa-check"></i>Special Predictors</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="regression.html"><a href="regression.html#model-evaluation"><i class="fa fa-check"></i><b>3.3</b> Model Evaluation</a>
<ul>
<li class="chapter" data-level="" data-path="regression.html"><a href="regression.html#outliers-leverage-points-and-influential-points"><i class="fa fa-check"></i>Outliers, Leverage Points, and Influential Points</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="regression.html"><a href="regression.html#variable-selection"><i class="fa fa-check"></i><b>3.4</b> Variable Selection</a></li>
<li class="chapter" data-level="3.5" data-path="regression.html"><a href="regression.html#predicting-values"><i class="fa fa-check"></i><b>3.5</b> Predicting Values</a></li>
<li class="chapter" data-level="3.6" data-path="regression.html"><a href="regression.html#nonlinear-regression"><i class="fa fa-check"></i><b>3.6</b> Nonlinear Regression</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exponential.html"><a href="exponential.html"><i class="fa fa-check"></i><b>4</b> Exponential Smoothing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="exponential.html"><a href="exponential.html#simple-exponential-smoothing-ses"><i class="fa fa-check"></i><b>4.1</b> Simple Exponential Smoothing (SES)</a></li>
<li class="chapter" data-level="4.2" data-path="exponential.html"><a href="exponential.html#holts-linear-method"><i class="fa fa-check"></i><b>4.2</b> Holt’s Linear Method</a></li>
<li class="chapter" data-level="4.3" data-path="exponential.html"><a href="exponential.html#additive-damped-trend-method"><i class="fa fa-check"></i><b>4.3</b> Additive Damped Trend Method</a></li>
<li class="chapter" data-level="4.4" data-path="exponential.html"><a href="exponential.html#holt-winters"><i class="fa fa-check"></i><b>4.4</b> Holt-Winters</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="exponential.html"><a href="exponential.html#additive-holt-winters-method"><i class="fa fa-check"></i><b>4.4.1</b> Additive Holt-Winters Method</a></li>
<li class="chapter" data-level="4.4.2" data-path="exponential.html"><a href="exponential.html#multiplicative-holt-winters-method"><i class="fa fa-check"></i><b>4.4.2</b> Multiplicative Holt-Winters Method</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="exponential.html"><a href="exponential.html#model-selection-with-cv"><i class="fa fa-check"></i><b>4.5</b> Model Selection with CV</a></li>
<li class="chapter" data-level="4.6" data-path="exponential.html"><a href="exponential.html#model-selection-via-maximum-likelihood"><i class="fa fa-check"></i><b>4.6</b> Model Selection via Maximum Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>5</b> ARIMA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="arima.html"><a href="arima.html#tranformations-and-differencing"><i class="fa fa-check"></i><b>5.1</b> Tranformations and Differencing</a></li>
<li class="chapter" data-level="5.2" data-path="arima.html"><a href="arima.html#autoregressive-models"><i class="fa fa-check"></i><b>5.2</b> Autoregressive Models</a></li>
<li class="chapter" data-level="5.3" data-path="arima.html"><a href="arima.html#moving-average-models"><i class="fa fa-check"></i><b>5.3</b> Moving Average Models</a></li>
<li class="chapter" data-level="5.4" data-path="arima.html"><a href="arima.html#non-seasonal-arima"><i class="fa fa-check"></i><b>5.4</b> Non-Seasonal ARIMA</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>6</b> Dynamic Harmonic Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="dynamic.html"><a href="dynamic.html#tbats-model"><i class="fa fa-check"></i><b>6.1</b> TBATS Model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exporation" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Exploratory Analysis<a href="exporation.html#exporation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Start an analysis by viewing the data values and structure, then take some summary statistics. <code>fabletools::features()</code> is great for this.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="exporation.html#cb30-1" tabindex="-1"></a>tsibbledata<span class="sc">::</span>aus_production <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="exporation.html#cb30-2" tabindex="-1"></a>  <span class="fu">features</span>(Beer, <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">quantile =</span> quantile))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##    mean `quantile_0%` `quantile_25%` `quantile_50%` `quantile_75%`
##   &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
## 1  415.           213           379.            422           466.
## # ℹ 1 more variable: `quantile_100%` &lt;dbl&gt;</code></pre>
<p>There are many autocorrelation features you might want to review. I don’t understand why you’d want to know all of these, but <code>feat_acf</code> has them.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="exporation.html#cb32-1" tabindex="-1"></a>tsibbledata<span class="sc">::</span>aus_production <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="exporation.html#cb32-2" tabindex="-1"></a>  <span class="fu">features</span>(Beer, feat_acf)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 7
##    acf1 acf10 diff1_acf1 diff1_acf10 diff2_acf1 diff2_acf10 season_acf1
##   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 0.684  4.37     -0.221        2.72     -0.361        2.26       0.940</code></pre>
<div id="graphical-analysis" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Graphical Analysis<a href="exporation.html#graphical-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The next task is to plot the data to identify patterns, unusual observations, changes over time, and relationships between variables. Look for <em>trend</em>, <em>cycles</em>, and <em>seasonality</em> in your exploratory plots. These features inform the subsequent forecasting process. <code>ggplot2::autoplot()</code> does a great job picking out the right plot, but I feel more comfortable staying old-school for now.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="exporation.html#cb34-1" tabindex="-1"></a>tsibbledata<span class="sc">::</span>ansett <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="exporation.html#cb34-2" tabindex="-1"></a>  <span class="fu">filter</span>(Airports <span class="sc">==</span> <span class="st">&quot;MEL-SYD&quot;</span>, Class <span class="sc">==</span> <span class="st">&quot;Economy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="exporation.html#cb34-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Week, <span class="at">y =</span> Passengers)) <span class="sc">+</span></span>
<span id="cb34-4"><a href="exporation.html#cb34-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="exporation.html#cb34-5" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb34-6"><a href="exporation.html#cb34-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Start with a simple time series plot.&quot;</span>,</span>
<span id="cb34-7"><a href="exporation.html#cb34-7" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Weekly passenger volume.&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>What does this one reveal?</p>
<ul>
<li>There was a period in 1989 of zero passengers (strike).</li>
<li>There was a period in 1992 where passenger load dropped (planes temporarily reconfigured).</li>
<li>Volume increased during the second half of 1992.</li>
<li>Several large post-holiday dips in volume.</li>
<li>Some larger trends of increasing and decreasing volume (the data is <em>cyclic</em>).</li>
<li>Also appears to be some missing observations. (<em>common practice with missing observations is to impute values with the time series mean.</em>)</li>
</ul>
<p>If a data series has trend and seasonality, highlight it with <code>feasts::gg_season()</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="exporation.html#cb35-1" tabindex="-1"></a>a10 <span class="ot">&lt;-</span> tsibbledata<span class="sc">::</span>PBS <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="exporation.html#cb35-2" tabindex="-1"></a>  <span class="fu">filter</span>(ATC2 <span class="sc">==</span> <span class="st">&quot;A10&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="exporation.html#cb35-3" tabindex="-1"></a>  <span class="fu">select</span>(Month, Cost) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="exporation.html#cb35-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Cost =</span> <span class="fu">sum</span>(Cost))</span>
<span id="cb35-5"><a href="exporation.html#cb35-5" tabindex="-1"></a></span>
<span id="cb35-6"><a href="exporation.html#cb35-6" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> a10 <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="exporation.html#cb35-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Month) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1995</span>, <span class="dv">2000</span>, <span class="dv">2005</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="exporation.html#cb35-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">month</span>(Month, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>), <span class="at">y =</span> Cost, </span>
<span id="cb35-9"><a href="exporation.html#cb35-9" tabindex="-1"></a>             <span class="at">group =</span> <span class="fu">factor</span>(<span class="fu">year</span>(Month)), </span>
<span id="cb35-10"><a href="exporation.html#cb35-10" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">factor</span>(<span class="fu">year</span>(Month)),</span>
<span id="cb35-11"><a href="exporation.html#cb35-11" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">if_else</span>(<span class="fu">month</span>(Month) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">12</span>), <span class="fu">year</span>(Month), <span class="cn">NA_real_</span>))) <span class="sc">+</span></span>
<span id="cb35-12"><a href="exporation.html#cb35-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb35-13"><a href="exporation.html#cb35-13" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb35-14"><a href="exporation.html#cb35-14" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb35-15"><a href="exporation.html#cb35-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb35-16"><a href="exporation.html#cb35-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;using gglot&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb35-17"><a href="exporation.html#cb35-17" tabindex="-1"></a></span>
<span id="cb35-18"><a href="exporation.html#cb35-18" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> a10 <span class="sc">%&gt;%</span></span>
<span id="cb35-19"><a href="exporation.html#cb35-19" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Month) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1995</span>, <span class="dv">2000</span>, <span class="dv">2005</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-20"><a href="exporation.html#cb35-20" tabindex="-1"></a>  <span class="fu">fill_gaps</span>() <span class="sc">%&gt;%</span>  <span class="co"># otherwise, gg_season() barks.</span></span>
<span id="cb35-21"><a href="exporation.html#cb35-21" tabindex="-1"></a>  <span class="fu">gg_season</span>(Cost, <span class="at">labels =</span> <span class="st">&quot;both&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-22"><a href="exporation.html#cb35-22" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb35-23"><a href="exporation.html#cb35-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb35-24"><a href="exporation.html#cb35-24" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;using feasts&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb35-25"><a href="exporation.html#cb35-25" tabindex="-1"></a></span>
<span id="cb35-26"><a href="exporation.html#cb35-26" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb35-27"><a href="exporation.html#cb35-27" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Medicare script costs increase from Feb - following Jan.&quot;</span>,</span>
<span id="cb35-28"><a href="exporation.html#cb35-28" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;12-month seasonality plot, selected years.&quot;</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Emphasize the seasonality further by faceting on the sub-series with <code>feasts::gg_subseries()</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="exporation.html#cb36-1" tabindex="-1"></a>yint <span class="ot">&lt;-</span> a10 <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="exporation.html#cb36-2" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="exporation.html#cb36-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">month</span>(Month, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="exporation.html#cb36-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_cost =</span> <span class="fu">mean</span>(Cost) <span class="sc">/</span> <span class="fl">1e6</span>)</span>
<span id="cb36-5"><a href="exporation.html#cb36-5" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> a10 <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="exporation.html#cb36-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">year</span>(Month), <span class="at">y =</span> Cost <span class="sc">/</span> <span class="fl">1e6</span>)) <span class="sc">+</span> </span>
<span id="cb36-7"><a href="exporation.html#cb36-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-8"><a href="exporation.html#cb36-8" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> yint, <span class="fu">aes</span>(<span class="at">yintercept =</span> mean_cost), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb36-9"><a href="exporation.html#cb36-9" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb36-10"><a href="exporation.html#cb36-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-11"><a href="exporation.html#cb36-11" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-12"><a href="exporation.html#cb36-12" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb36-13"><a href="exporation.html#cb36-13" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb36-14"><a href="exporation.html#cb36-14" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(<span class="fu">month</span>(Month, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>)), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-15"><a href="exporation.html#cb36-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;using gglot&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb36-16"><a href="exporation.html#cb36-16" tabindex="-1"></a></span>
<span id="cb36-17"><a href="exporation.html#cb36-17" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> a10 <span class="sc">%&gt;%</span></span>
<span id="cb36-18"><a href="exporation.html#cb36-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cost =</span> Cost <span class="sc">/</span> <span class="fl">1e6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-19"><a href="exporation.html#cb36-19" tabindex="-1"></a>  <span class="fu">fill_gaps</span>() <span class="sc">%&gt;%</span>  <span class="co"># otherwise, gg_subseries() barks.</span></span>
<span id="cb36-20"><a href="exporation.html#cb36-20" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(Cost) <span class="sc">+</span></span>
<span id="cb36-21"><a href="exporation.html#cb36-21" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb36-22"><a href="exporation.html#cb36-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-23"><a href="exporation.html#cb36-23" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-24"><a href="exporation.html#cb36-24" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb36-25"><a href="exporation.html#cb36-25" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb36-26"><a href="exporation.html#cb36-26" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;using feasts&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb36-27"><a href="exporation.html#cb36-27" tabindex="-1"></a></span>
<span id="cb36-28"><a href="exporation.html#cb36-28" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span></span>
<span id="cb36-29"><a href="exporation.html#cb36-29" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Medicare script costs follow monthly seasonality, inreasing annually.&quot;</span>,</span>
<span id="cb36-30"><a href="exporation.html#cb36-30" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Monthly subseries plot of cost $MM, 1991 - 2009.&quot;</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Explore the correlation between two quantitative variables with the Pearson correlation coefficient. Recall that the covariance between series <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is defined <span class="math inline">\(Cov(X, Y) = E[(X - \mu_X) (Y - \mu_Y)]\)</span> which simplifies to <span class="math inline">\(Cov(X, Y) = E[XY] - \mu_X \mu_Y\)</span>. The covariance of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is positive if <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> increase together, negative if they move in opposite directions, and if <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent, <span class="math inline">\(E[XY] = E[X]E[Y] = \mu_X \mu_Y\)</span>, so <span class="math inline">\(Cov(X, Y) = 0\)</span>. Covariance is usually inconvenient because its values depend on the units of the series. Dividing <span class="math inline">\(Cov(X, Y)\)</span> by the standard deviations <span class="math inline">\(\sigma_X \sigma_Y\)</span> creates a unit-less variable with range [-1, 1], also known as the Pearson correlation.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<p><span class="math display">\[\rho = \frac{\sigma_{XY}} {\sigma_X \sigma_Y}.\]</span></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="exporation.html#cb37-1" tabindex="-1"></a>PBS <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="exporation.html#cb37-2" tabindex="-1"></a>  <span class="fu">group_by</span>(ATC1) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="exporation.html#cb37-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>, <span class="at">Cost =</span> <span class="fu">sum</span>(Cost)) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="exporation.html#cb37-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> ATC1, <span class="at">values_from =</span> Cost) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="exporation.html#cb37-5" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="exporation.html#cb37-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Month) <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="exporation.html#cb37-7" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="exporation.html#cb37-8" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>() <span class="sc">+</span></span>
<span id="cb37-9"><a href="exporation.html#cb37-9" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb37-10"><a href="exporation.html#cb37-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Z and P indexes negatively correlated with others.&quot;</span>,</span>
<span id="cb37-11"><a href="exporation.html#cb37-11" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Correlation plot of Medicare ATC1 indexes.&quot;</span>, </span>
<span id="cb37-12"><a href="exporation.html#cb37-12" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Autocorrelation is correlation with lagging observations. Lag plots of current period vs lags are a particular kind of correlation scatterplot useful for identifying seasonality. <code>feasts::ACF()</code> extends the base R <code>acf()</code> function to tsibbles. <code>aus_production</code> contains quarterly production levels. The 4-period lag is a year-over-year correlation and is strong because of seasonality in production. The 8-period lag is less strong. The 1-, 2-, and 3-period lags are not positively correlated. In fact, the lag-2 is negatively correlated.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="exporation.html#cb38-1" tabindex="-1"></a>prod2k <span class="ot">&lt;-</span> tsibbledata<span class="sc">::</span>aus_production <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="exporation.html#cb38-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">2000</span>)</span>
<span id="cb38-3"><a href="exporation.html#cb38-3" tabindex="-1"></a></span>
<span id="cb38-4"><a href="exporation.html#cb38-4" tabindex="-1"></a>prod2k <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="exporation.html#cb38-5" tabindex="-1"></a>  <span class="fu">gg_lag</span>(Beer, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-6"><a href="exporation.html#cb38-6" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb38-7"><a href="exporation.html#cb38-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Production is seasonal with Q4 peak, Q1 second.&quot;</span>,</span>
<span id="cb38-8"><a href="exporation.html#cb38-8" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Quarterly lag plot of beer production&quot;</span>,</span>
<span id="cb38-9"><a href="exporation.html#cb38-9" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) </span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="exporation.html#cb39-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> prod2k <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="exporation.html#cb39-2" tabindex="-1"></a>  <span class="fu">ACF</span>(Beer, <span class="at">lag_max =</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="exporation.html#cb39-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag)) <span class="sc">+</span> </span>
<span id="cb39-4"><a href="exporation.html#cb39-4" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> acf), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-5"><a href="exporation.html#cb39-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> acf), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-6"><a href="exporation.html#cb39-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb39-7"><a href="exporation.html#cb39-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">nrow</span>(prod2k)), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-8"><a href="exporation.html#cb39-8" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">+</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">nrow</span>(prod2k)), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="exporation.html#cb39-9" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb39-10"><a href="exporation.html#cb39-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb39-11"><a href="exporation.html#cb39-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;using ggplot&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb39-12"><a href="exporation.html#cb39-12" tabindex="-1"></a></span>
<span id="cb39-13"><a href="exporation.html#cb39-13" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> prod2k <span class="sc">%&gt;%</span> </span>
<span id="cb39-14"><a href="exporation.html#cb39-14" tabindex="-1"></a>  <span class="fu">ACF</span>(Beer, <span class="at">lag_max =</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-15"><a href="exporation.html#cb39-15" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb39-16"><a href="exporation.html#cb39-16" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb39-17"><a href="exporation.html#cb39-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;using autoplot&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb39-18"><a href="exporation.html#cb39-18" tabindex="-1"></a></span>
<span id="cb39-19"><a href="exporation.html#cb39-19" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb39-20"><a href="exporation.html#cb39-20" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Strongest correlation is 4-period lag, negative 2-period lag.&quot;</span>,</span>
<span id="cb39-21"><a href="exporation.html#cb39-21" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Quarterly autocorrelation of beer production.&quot;</span>,</span>
<span id="cb39-22"><a href="exporation.html#cb39-22" tabindex="-1"></a>                  <span class="at">caption =</span> <span class="st">&quot;Dashed lines are +/- square root of series length, the white noise bound.&quot;</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-24-2.png" width="672" /></p>
<ul>
<li><p>Autocorrelation for <em>trending</em> data tends to be large and positive because observations nearby in time are also nearby in size. The ACF tends to have positive values that slowly decrease as the lags increase.</p></li>
<li><p>Autocorrelation for <em>seasonal</em> data tends to be larger for the seasonal lags (at multiples of the seasonal frequency). The Quarterly Australian Beer Production ACF above shows seasonality.</p></li>
<li><p>Autocorrelation for <em>both trended and seasonal</em> data has a combination of these effects.</p></li>
<li><p>Time series that show no autocorrelation are called <strong>white noise</strong>. White noise series have near-zero autocorrelation. Stock price changes often exhibit white noise. Almost all lags have autocorrelation insignificantly different from zero. Expect 95% of spikes to lie withing <span class="math inline">\(\pm 2 / \sqrt{T}\)</span> where <span class="math inline">\(T\)</span> is the length of the data series.</p></li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="exporation.html#cb40-1" tabindex="-1"></a>stock <span class="ot">&lt;-</span> tsibbledata<span class="sc">::</span>gafa_stock <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="exporation.html#cb40-2" tabindex="-1"></a>  <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">&quot;FB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="exporation.html#cb40-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">l1 =</span> Close <span class="sc">-</span> <span class="fu">lag</span>(Close))</span>
<span id="cb40-4"><a href="exporation.html#cb40-4" tabindex="-1"></a></span>
<span id="cb40-5"><a href="exporation.html#cb40-5" tabindex="-1"></a>stock <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="exporation.html#cb40-6" tabindex="-1"></a>  <span class="fu">ACF</span>(l1, <span class="at">lag_max =</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="exporation.html#cb40-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag)) <span class="sc">+</span> </span>
<span id="cb40-8"><a href="exporation.html#cb40-8" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> acf), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-9"><a href="exporation.html#cb40-9" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> acf), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-10"><a href="exporation.html#cb40-10" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb40-11"><a href="exporation.html#cb40-11" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">nrow</span>(stock)), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb40-12"><a href="exporation.html#cb40-12" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">+</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">nrow</span>(stock)), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb40-13"><a href="exporation.html#cb40-13" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb40-14"><a href="exporation.html#cb40-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb40-15"><a href="exporation.html#cb40-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Stock price changes tend to exhibit white noise.&quot;</span>,</span>
<span id="cb40-16"><a href="exporation.html#cb40-16" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Daily autocorrelation of stock price changes.&quot;</span>,</span>
<span id="cb40-17"><a href="exporation.html#cb40-17" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Dashed lines are +/- square root of series length, the white noise bound.&quot;</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>The Ljung-Box test tests the randomness of a series; a <em>p</em>-value under 0.05 rejects the null hypothesis of white noise. The test reject white noise for the beer production, but not for stock price changes.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="exporation.html#cb41-1" tabindex="-1"></a><span class="fu">Box.test</span>(prod2k<span class="sc">$</span>Beer, <span class="at">lag =</span> <span class="dv">16</span>, <span class="at">fitdf =</span> <span class="dv">0</span>, <span class="at">type =</span> <span class="st">&quot;Ljung&quot;</span>)</span>
<span id="cb41-2"><a href="exporation.html#cb41-2" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb41-3"><a href="exporation.html#cb41-3" tabindex="-1"></a><span class="do">##  Box-Ljung test</span></span>
<span id="cb41-4"><a href="exporation.html#cb41-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb41-5"><a href="exporation.html#cb41-5" tabindex="-1"></a><span class="do">## data:  prod2k$Beer</span></span>
<span id="cb41-6"><a href="exporation.html#cb41-6" tabindex="-1"></a><span class="do">## X-squared = 187.44, df = 16, p-value &lt; 2.2e-16</span></span>
<span id="cb41-7"><a href="exporation.html#cb41-7" tabindex="-1"></a><span class="fu">Box.test</span>(stock<span class="sc">$</span>l1, <span class="at">lag =</span> <span class="dv">16</span>, <span class="at">fitdf =</span> <span class="dv">0</span>, <span class="at">type =</span> <span class="st">&quot;Ljung&quot;</span>)</span>
<span id="cb41-8"><a href="exporation.html#cb41-8" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb41-9"><a href="exporation.html#cb41-9" tabindex="-1"></a><span class="do">##  Box-Ljung test</span></span>
<span id="cb41-10"><a href="exporation.html#cb41-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb41-11"><a href="exporation.html#cb41-11" tabindex="-1"></a><span class="do">## data:  stock$l1</span></span>
<span id="cb41-12"><a href="exporation.html#cb41-12" tabindex="-1"></a><span class="do">## X-squared = 16.745, df = 16, p-value = 0.4023</span></span></code></pre></div>
</div>
<div id="transformations" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Transformations<a href="exporation.html#transformations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Remove known sources of variation (e.g., days per month, population growth, inflation). E.g., monthly totals may vary due to differing month lengths.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="exporation.html#cb42-1" tabindex="-1"></a>milk <span class="ot">&lt;-</span> fma<span class="sc">::</span>milk <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="exporation.html#cb42-2" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">%&gt;%</span> <span class="co"># milk is a `ts` object</span></span>
<span id="cb42-3"><a href="exporation.html#cb42-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">daily_avg =</span> value <span class="sc">/</span> lubridate<span class="sc">::</span><span class="fu">days_in_month</span>(index))</span>
<span id="cb42-4"><a href="exporation.html#cb42-4" tabindex="-1"></a></span>
<span id="cb42-5"><a href="exporation.html#cb42-5" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> milk <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="exporation.html#cb42-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb42-7"><a href="exporation.html#cb42-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="exporation.html#cb42-8" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb42-9"><a href="exporation.html#cb42-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb42-10"><a href="exporation.html#cb42-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Original&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb42-11"><a href="exporation.html#cb42-11" tabindex="-1"></a></span>
<span id="cb42-12"><a href="exporation.html#cb42-12" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> milk <span class="sc">%&gt;%</span></span>
<span id="cb42-13"><a href="exporation.html#cb42-13" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> daily_avg)) <span class="sc">+</span></span>
<span id="cb42-14"><a href="exporation.html#cb42-14" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-15"><a href="exporation.html#cb42-15" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb42-16"><a href="exporation.html#cb42-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Daily Average&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb42-17"><a href="exporation.html#cb42-17" tabindex="-1"></a></span>
<span id="cb42-18"><a href="exporation.html#cb42-18" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span></span>
<span id="cb42-19"><a href="exporation.html#cb42-19" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Convert monthly sums into daily averages per month.&quot;</span>,</span>
<span id="cb42-20"><a href="exporation.html#cb42-20" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Average daily milk production by month.&quot;</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Make patterns more consistent across the data set. Simpler patterns usually lead to more accurate forecasts. A Box-Cox transformation can equalize seasonal variation.</p>
<p><span class="math display">\[w_t = \begin{cases} \mathrm{log}(y_t), &amp; \mbox{if } \lambda\mbox{ = 0} \\
\left(\mathrm{sign}(y_t) |y_t|^\lambda - 1 \right) / \lambda, &amp; \mbox{otherwise} \end{cases}\]</span></p>
<p><span class="math inline">\(\lambda\)</span> can take any value, but values near the following yield familiar transformations.</p>
<ul>
<li><span class="math inline">\(\lambda = 1\)</span>: no substantive transformation.<br />
</li>
<li><span class="math inline">\(\lambda = 0.5\)</span>: square root plus linear transformation.</li>
<li><span class="math inline">\(\lambda = 0.333\)</span>: cube root plus linear transformation.</li>
<li><span class="math inline">\(\lambda = 0\)</span>: natural log.</li>
<li><span class="math inline">\(\lambda = -1\)</span>: inverse.</li>
</ul>
<p>A good value of <span class="math inline">\(\lambda\)</span> is one which makes the size of the seasonal variation about the same across the whole series. <code>fabletools::features()</code> and <code>BoxCox.lambda()</code> optimize <span class="math inline">\(\lambda\)</span>, but try to choose a simple value to make interpretation clearer. Note that while forecasts are not sensitive to <span class="math inline">\(\lambda\)</span>, prediction intervals <em>are</em>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="exporation.html#cb43-1" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> tsibbledata<span class="sc">::</span>aus_production <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="exporation.html#cb43-2" tabindex="-1"></a>  <span class="co"># guerrero() applies Guerrero&#39;s method to select lambda that minimizes the</span></span>
<span id="cb43-3"><a href="exporation.html#cb43-3" tabindex="-1"></a>  <span class="co"># coefficient of variation: .12.</span></span>
<span id="cb43-4"><a href="exporation.html#cb43-4" tabindex="-1"></a>  <span class="fu">features</span>(Gas, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="exporation.html#cb43-5" tabindex="-1"></a>  <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb43-6"><a href="exporation.html#cb43-6" tabindex="-1"></a></span>
<span id="cb43-7"><a href="exporation.html#cb43-7" tabindex="-1"></a><span class="co"># supposedly the same method, but returns .10 instead.</span></span>
<span id="cb43-8"><a href="exporation.html#cb43-8" tabindex="-1"></a>lambda_v2 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">BoxCox.lambda</span>(aus_production<span class="sc">$</span>Gas, <span class="at">method =</span> <span class="st">&quot;guerrero&quot;</span>)</span>
<span id="cb43-9"><a href="exporation.html#cb43-9" tabindex="-1"></a></span>
<span id="cb43-10"><a href="exporation.html#cb43-10" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> aus_production <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="exporation.html#cb43-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gas_xform =</span> <span class="fu">box_cox</span>(Gas, lambda)) <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="exporation.html#cb43-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Quarter)) <span class="sc">+</span></span>
<span id="cb43-13"><a href="exporation.html#cb43-13" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Gas), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-14"><a href="exporation.html#cb43-14" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb43-15"><a href="exporation.html#cb43-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb43-16"><a href="exporation.html#cb43-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Original&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span>
<span id="cb43-17"><a href="exporation.html#cb43-17" tabindex="-1"></a></span>
<span id="cb43-18"><a href="exporation.html#cb43-18" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> aus_production <span class="sc">%&gt;%</span></span>
<span id="cb43-19"><a href="exporation.html#cb43-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gas_xform =</span> <span class="fu">box_cox</span>(Gas, lambda)) <span class="sc">%&gt;%</span></span>
<span id="cb43-20"><a href="exporation.html#cb43-20" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Quarter)) <span class="sc">+</span></span>
<span id="cb43-21"><a href="exporation.html#cb43-21" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> gas_xform), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-22"><a href="exporation.html#cb43-22" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb43-23"><a href="exporation.html#cb43-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Box-Cox, lambda = {scales::comma(lambda, accuracy = 0.01)}&quot;</span>),</span>
<span id="cb43-24"><a href="exporation.html#cb43-24" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">glue</span>(<span class="st">&quot;Gas^{scales::comma(lambda, accuracy = 0.01)}&quot;</span>))</span>
<span id="cb43-25"><a href="exporation.html#cb43-25" tabindex="-1"></a></span>
<span id="cb43-26"><a href="exporation.html#cb43-26" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span> </span>
<span id="cb43-27"><a href="exporation.html#cb43-27" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Box-Cox transformation equalizes the seasonal component.&quot;</span>,</span>
<span id="cb43-28"><a href="exporation.html#cb43-28" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Box-Cox transformation (Guerrero&#39;s method) of quarterly gas production.&quot;</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>
<div id="decomposition" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Decomposition<a href="exporation.html#decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Time series data often has trending, seasonality, and cycles. It’s usually useful to lump trending and cycles into a trend-cycle components, or simply “trend”, and treat time series data as consisting of seasonality <span class="math inline">\(S_t\)</span>, trend <span class="math inline">\(T_t\)</span>, and a remainder <span class="math inline">\(R_t\)</span>. If the magnitude of the seasonal fluctuations and the variation in the trend cycle are constant, then these components are additive, <span class="math inline">\(y_t = S_t + T_t + R_t\)</span>; if they are proportional to the level, then these components are multiplicative, <span class="math inline">\(y_t = S_t \times T_t \times R_t\)</span>.</p>
<div id="classical-decomposition" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Classical Decomposition<a href="exporation.html#classical-decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Classical decomposition was commonly used until the 1950s. It is still the basis of other methods, so it is good to understand. Classical decomposition is based on moving averages. An <em>m</em>-MA moving average of order <span class="math inline">\(m = 2k + 1\)</span> averages the <span class="math inline">\(k\)</span> observations before <span class="math inline">\(t\)</span> through the <span class="math inline">\(k\)</span> observations after <span class="math inline">\(t\)</span>. The <code>slider</code> package is great for this. <span class="math inline">\(m\)</span> is usually an odd number so that the number of periods before and after are equal.</p>
<p><span class="math display">\[\hat{T}_t = \frac{1}{m}\sum_{j = -k}^k y_{t+j}\]</span></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="exporation.html#cb44-1" tabindex="-1"></a><span class="fu">library</span>(slider) <span class="co"># sliding window functions</span></span></code></pre></div>
<pre><code>## Warning: package &#39;slider&#39; was built under R version 4.3.1</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="exporation.html#cb46-1" tabindex="-1"></a>tsibbledata<span class="sc">::</span>global_economy <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="exporation.html#cb46-2" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">&quot;Australia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="exporation.html#cb46-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-4"><a href="exporation.html#cb46-4" tabindex="-1"></a>    <span class="st">`</span><span class="at">3-MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">slide_dbl</span>(Exports, mean, <span class="at">.before =</span> <span class="dv">1</span>, <span class="at">.after =</span> <span class="dv">1</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-5"><a href="exporation.html#cb46-5" tabindex="-1"></a>    <span class="st">`</span><span class="at">5-MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">slide_dbl</span>(Exports, mean, <span class="at">.before =</span> <span class="dv">2</span>, <span class="at">.after =</span> <span class="dv">2</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-6"><a href="exporation.html#cb46-6" tabindex="-1"></a>    <span class="st">`</span><span class="at">7-MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">slide_dbl</span>(Exports, mean, <span class="at">.before =</span> <span class="dv">3</span>, <span class="at">.after =</span> <span class="dv">3</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-7"><a href="exporation.html#cb46-7" tabindex="-1"></a>    <span class="st">`</span><span class="at">9-MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">slide_dbl</span>(Exports, mean, <span class="at">.before =</span> <span class="dv">4</span>, <span class="at">.after =</span> <span class="dv">4</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-8"><a href="exporation.html#cb46-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="exporation.html#cb46-9" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">&quot;-MA&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;MA_name&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;MA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-10"><a href="exporation.html#cb46-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year)) <span class="sc">+</span></span>
<span id="cb46-11"><a href="exporation.html#cb46-11" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> MA, <span class="at">color =</span> MA_name), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb46-12"><a href="exporation.html#cb46-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Exports), <span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">color =</span> <span class="st">&quot;#000000&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb46-13"><a href="exporation.html#cb46-13" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb46-14"><a href="exporation.html#cb46-14" tabindex="-1"></a><span class="co">#  guides(color = guide_legend(title = &quot;series&quot;)) +</span></span>
<span id="cb46-15"><a href="exporation.html#cb46-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;m-MA simple moving averages smooth a time series.&quot;</span>,</span>
<span id="cb46-16"><a href="exporation.html#cb46-16" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;m-MA of annual export proportion of GDP for m = 3, 5, 7, 9.&quot;</span>, </span>
<span id="cb46-17"><a href="exporation.html#cb46-17" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;Pct of GDP&quot;</span>, <span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>But what if you have known seasonal periods in the data? For example, with quarterly seasonality it makes sense to take a moving average of the 4 periods at once. Do this with a moving average of a four-period moving average.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="exporation.html#cb47-1" tabindex="-1"></a>tsibbledata<span class="sc">::</span>aus_production <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="exporation.html#cb47-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="exporation.html#cb47-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb47-4"><a href="exporation.html#cb47-4" tabindex="-1"></a>    <span class="st">`</span><span class="at">4-MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">slide_dbl</span>(Beer, mean, <span class="at">.before =</span> <span class="dv">1</span>, <span class="at">.after =</span> <span class="dv">2</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-5"><a href="exporation.html#cb47-5" tabindex="-1"></a>    <span class="st">`</span><span class="at">2x4-MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">slide_dbl</span>(<span class="st">`</span><span class="at">4-MA</span><span class="st">`</span>, mean, <span class="at">.before =</span> <span class="dv">1</span>, <span class="at">.after =</span> <span class="dv">0</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-6"><a href="exporation.html#cb47-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="exporation.html#cb47-7" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">&quot;-MA&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;MA_type&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;MA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="exporation.html#cb47-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Quarter)) <span class="sc">+</span></span>
<span id="cb47-9"><a href="exporation.html#cb47-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Beer), <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb47-10"><a href="exporation.html#cb47-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> MA, <span class="at">color =</span> MA_type), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb47-11"><a href="exporation.html#cb47-11" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb47-12"><a href="exporation.html#cb47-12" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_few</span>() <span class="sc">+</span></span>
<span id="cb47-13"><a href="exporation.html#cb47-13" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">&quot;series&quot;</span>)) <span class="sc">+</span></span>
<span id="cb47-14"><a href="exporation.html#cb47-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;MAs of MAs smooth seasonal periods.&quot;</span>,</span>
<span id="cb47-15"><a href="exporation.html#cb47-15" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;2-MA of a 4-MA for quarterly data.&quot;</span>,</span>
<span id="cb47-16"><a href="exporation.html#cb47-16" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Classical decomposition calculates a trend-cycle component <span class="math inline">\(\hat{T}_t\)</span> with an <em>m</em>-MA (odd order) or <span class="math inline">\(2 \times m\)</span>-MA. The de-trended series is the difference, <span class="math inline">\(y_t - \hat{T}_t\)</span>. The seasonal component <span class="math inline">\(\hat{S}_t\)</span> is the seasonal average (e.g., for monthly seasons, then <span class="math inline">\(\hat{S}_1\)</span> would be the January average). The remainder is the residual, <span class="math inline">\(\hat{R}_t = y_t - \hat{T}_t - \hat{S}_t.\)</span> If the cycle variation and seasonal magnitude increases with the observation level, then the same principles apply except the subtrations are replaced with divisions, <span class="math inline">\(y_t / \hat{T}_t\)</span> and remainder <span class="math inline">\(\hat{R}_t = y_t / (\hat{T}_t \hat{S}_t)\)</span>.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="exporation.html#cb48-1" tabindex="-1"></a>fpp3<span class="sc">::</span>us_employment <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="exporation.html#cb48-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">1990</span> <span class="sc">&amp;</span> Title <span class="sc">==</span> <span class="st">&quot;Retail Trade&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="exporation.html#cb48-3" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">classical =</span> <span class="fu">classical_decomposition</span>(Employed, <span class="at">type =</span> <span class="st">&quot;additive&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="exporation.html#cb48-4" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="exporation.html#cb48-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Employed<span class="sc">:</span>random, </span>
<span id="cb48-6"><a href="exporation.html#cb48-6" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;component&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;employed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="exporation.html#cb48-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">component =</span> <span class="fu">factor</span>(component, </span>
<span id="cb48-8"><a href="exporation.html#cb48-8" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Employed&quot;</span>, <span class="st">&quot;trend&quot;</span>, <span class="st">&quot;seasonal&quot;</span>, <span class="st">&quot;random&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="exporation.html#cb48-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">y =</span> employed)) <span class="sc">+</span></span>
<span id="cb48-10"><a href="exporation.html#cb48-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-11"><a href="exporation.html#cb48-11" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb48-12"><a href="exporation.html#cb48-12" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(component), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-13"><a href="exporation.html#cb48-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Classical additive decomposition of US retail employment&quot;</span>,</span>
<span id="cb48-14"><a href="exporation.html#cb48-14" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Employed = trend + seasonal + random&quot;</span>,</span>
<span id="cb48-15"><a href="exporation.html#cb48-15" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Classical decomposition has weaknesses: the trend-cycle is unavailable for the first few and and last few periods; it assumes the seasonal component is stable over time; and it also tends to over-smooth the data.</p>
</div>
<div id="x-11-and-seats" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> X-11 and SEATS<a href="exporation.html#x-11-and-seats" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>X-11 and Seasonal Extraction in ARIMA Time Series (SEATS) are commonly used by governmental agencies. X-11 overcomes some of classical decomposition’s drawbacks by adding extra steps. It creates trend-cycle estimates for all periods, and accommodates a slowly varying seasonal component.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="exporation.html#cb49-1" tabindex="-1"></a>fpp3<span class="sc">::</span>us_employment <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="exporation.html#cb49-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">1990</span> <span class="sc">&amp;</span> Title <span class="sc">==</span> <span class="st">&quot;Retail Trade&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="exporation.html#cb49-3" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">x11 =</span> <span class="fu">X_13ARIMA_SEATS</span>(Employed <span class="sc">~</span> <span class="fu">x11</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="exporation.html#cb49-4" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="exporation.html#cb49-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Employed<span class="sc">:</span>irregular, </span>
<span id="cb49-6"><a href="exporation.html#cb49-6" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;component&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;employed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-7"><a href="exporation.html#cb49-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">component =</span> <span class="fu">factor</span>(component, </span>
<span id="cb49-8"><a href="exporation.html#cb49-8" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Employed&quot;</span>, <span class="st">&quot;trend&quot;</span>, <span class="st">&quot;seasonal&quot;</span>, <span class="st">&quot;irregular&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb49-9"><a href="exporation.html#cb49-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">y =</span> employed)) <span class="sc">+</span></span>
<span id="cb49-10"><a href="exporation.html#cb49-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-11"><a href="exporation.html#cb49-11" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb49-12"><a href="exporation.html#cb49-12" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(component), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-13"><a href="exporation.html#cb49-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;X11 decomposition of US retail employment&quot;</span>,</span>
<span id="cb49-14"><a href="exporation.html#cb49-14" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Employed = trend + seasonal + irregular&quot;</span>,</span>
<span id="cb49-15"><a href="exporation.html#cb49-15" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>SEATS is another one (too complicated to discuss evidently!).</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="exporation.html#cb50-1" tabindex="-1"></a>fpp3<span class="sc">::</span>us_employment <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="exporation.html#cb50-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">1990</span> <span class="sc">&amp;</span> Title <span class="sc">==</span> <span class="st">&quot;Retail Trade&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="exporation.html#cb50-3" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">x11 =</span> <span class="fu">X_13ARIMA_SEATS</span>(Employed <span class="sc">~</span> <span class="fu">seats</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="exporation.html#cb50-4" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="exporation.html#cb50-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Employed<span class="sc">:</span>irregular, </span>
<span id="cb50-6"><a href="exporation.html#cb50-6" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;component&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;employed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-7"><a href="exporation.html#cb50-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">component =</span> <span class="fu">factor</span>(component, </span>
<span id="cb50-8"><a href="exporation.html#cb50-8" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Employed&quot;</span>, <span class="st">&quot;trend&quot;</span>, <span class="st">&quot;seasonal&quot;</span>, <span class="st">&quot;irregular&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb50-9"><a href="exporation.html#cb50-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">y =</span> employed)) <span class="sc">+</span></span>
<span id="cb50-10"><a href="exporation.html#cb50-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-11"><a href="exporation.html#cb50-11" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb50-12"><a href="exporation.html#cb50-12" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(component), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-13"><a href="exporation.html#cb50-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;SEATS decomposition of US retail employment&quot;</span>,</span>
<span id="cb50-14"><a href="exporation.html#cb50-14" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Employed = f(trend, seasonal, irregular)&quot;</span>,</span>
<span id="cb50-15"><a href="exporation.html#cb50-15" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
</div>
<div id="stl" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> STL<a href="exporation.html#stl" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Seasonal and Trend decomposition using Loess (STL) has several advantages over classical decomposition, and the SEATS and X-11 methods. It handles any type of seasonality (not just monthly and quarterly); the seasonality component can change; the smoothness of the trend-cycle can be changed by the modeler; and it is robust to outliers.</p>
<p>The <code>widow</code> settings inside <code>model()</code> control how rapidly the components change.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="exporation.html#cb51-1" tabindex="-1"></a>fpp3<span class="sc">::</span>us_employment <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="exporation.html#cb51-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">1990</span> <span class="sc">&amp;</span> Title <span class="sc">==</span> <span class="st">&quot;Retail Trade&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="exporation.html#cb51-3" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">STL =</span> <span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="st">&quot;periodic&quot;</span>),</span>
<span id="cb51-4"><a href="exporation.html#cb51-4" tabindex="-1"></a>                  <span class="at">robust =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="exporation.html#cb51-5" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="exporation.html#cb51-6" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Employed<span class="sc">:</span>remainder, </span>
<span id="cb51-7"><a href="exporation.html#cb51-7" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;component&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;employed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="exporation.html#cb51-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">component =</span> <span class="fu">factor</span>(component, </span>
<span id="cb51-9"><a href="exporation.html#cb51-9" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Employed&quot;</span>, <span class="st">&quot;trend&quot;</span>, <span class="st">&quot;season_year&quot;</span>, <span class="st">&quot;remainder&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="exporation.html#cb51-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">y =</span> employed)) <span class="sc">+</span></span>
<span id="cb51-11"><a href="exporation.html#cb51-11" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-12"><a href="exporation.html#cb51-12" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb51-13"><a href="exporation.html#cb51-13" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(component), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="exporation.html#cb51-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;STL decomposition of US retail employment&quot;</span>,</span>
<span id="cb51-15"><a href="exporation.html#cb51-15" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Employed = f(trend, seasonal, irregular)&quot;</span>,</span>
<span id="cb51-16"><a href="exporation.html#cb51-16" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>STL decomposition is the basis for other insights into the data series. You can measure the relative strength of trend and seasonality by the relative size of their variance: <span class="math inline">\(F_T = 1 - \mathrm{Var}(R_T) / \mathrm{Var}(R_T + T_T)\)</span> and <span class="math inline">\(F_S = 1 - \mathrm{Var}(S_T) / \mathrm{Var}(S_T + T_T)\)</span>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="exporation.html#cb52-1" tabindex="-1"></a>us_employment_featues <span class="ot">&lt;-</span> fpp3<span class="sc">::</span>us_employment <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="exporation.html#cb52-2" tabindex="-1"></a>  <span class="fu">features</span>(Employed, feat_stl) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="exporation.html#cb52-3" tabindex="-1"></a>  <span class="fu">inner_join</span>(fpp3<span class="sc">::</span>us_employment <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(Series_ID, Title) <span class="sc">%&gt;%</span> <span class="fu">unique</span>(), </span>
<span id="cb52-4"><a href="exporation.html#cb52-4" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">&quot;Series_ID&quot;</span>)</span>
<span id="cb52-5"><a href="exporation.html#cb52-5" tabindex="-1"></a></span>
<span id="cb52-6"><a href="exporation.html#cb52-6" tabindex="-1"></a>us_1 <span class="ot">&lt;-</span> us_employment_featues <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="exporation.html#cb52-7" tabindex="-1"></a>  <span class="fu">filter</span>(trend_strength <span class="sc">&gt;=</span> <span class="fl">0.995</span> <span class="sc">&amp;</span> seasonal_strength_year <span class="sc">&gt;</span> <span class="fl">0.9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="exporation.html#cb52-8" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="exporation.html#cb52-9" tabindex="-1"></a>  <span class="fu">pull</span>(Series_ID)</span>
<span id="cb52-10"><a href="exporation.html#cb52-10" tabindex="-1"></a>us_2 <span class="ot">&lt;-</span> us_employment_featues <span class="sc">%&gt;%</span></span>
<span id="cb52-11"><a href="exporation.html#cb52-11" tabindex="-1"></a>  <span class="fu">filter</span>(trend_strength <span class="sc">&gt;=</span> <span class="fl">0.995</span> <span class="sc">&amp;</span> seasonal_strength_year <span class="sc">&lt;</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-12"><a href="exporation.html#cb52-12" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-13"><a href="exporation.html#cb52-13" tabindex="-1"></a>  <span class="fu">pull</span>(Series_ID)</span>
<span id="cb52-14"><a href="exporation.html#cb52-14" tabindex="-1"></a>us_3 <span class="ot">&lt;-</span> us_employment_featues <span class="sc">%&gt;%</span></span>
<span id="cb52-15"><a href="exporation.html#cb52-15" tabindex="-1"></a>  <span class="fu">filter</span>(trend_strength <span class="sc">&lt;=</span> <span class="fl">0.985</span> <span class="sc">&amp;</span> seasonal_strength_year <span class="sc">&lt;</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-16"><a href="exporation.html#cb52-16" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-17"><a href="exporation.html#cb52-17" tabindex="-1"></a>  <span class="fu">pull</span>(Series_ID)</span>
<span id="cb52-18"><a href="exporation.html#cb52-18" tabindex="-1"></a>us_4 <span class="ot">&lt;-</span> us_employment_featues <span class="sc">%&gt;%</span></span>
<span id="cb52-19"><a href="exporation.html#cb52-19" tabindex="-1"></a>  <span class="fu">filter</span>(trend_strength <span class="sc">&lt;=</span> <span class="fl">0.985</span> <span class="sc">&amp;</span> seasonal_strength_year <span class="sc">&gt;</span> <span class="fl">0.9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-20"><a href="exporation.html#cb52-20" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-21"><a href="exporation.html#cb52-21" tabindex="-1"></a>  <span class="fu">pull</span>(Series_ID)</span>
<span id="cb52-22"><a href="exporation.html#cb52-22" tabindex="-1"></a>us_employment_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(us_1, us_2, us_3, us_4)</span>
<span id="cb52-23"><a href="exporation.html#cb52-23" tabindex="-1"></a>us_employment_featues <span class="sc">%&gt;%</span> </span>
<span id="cb52-24"><a href="exporation.html#cb52-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Series_lbl =</span> <span class="fu">if_else</span>(Series_ID <span class="sc">%in%</span> us_employment_ids, Title, <span class="cn">NA_character_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-25"><a href="exporation.html#cb52-25" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> trend_strength, <span class="at">y =</span> seasonal_strength_year)) <span class="sc">+</span></span>
<span id="cb52-26"><a href="exporation.html#cb52-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-27"><a href="exporation.html#cb52-27" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Series_lbl), <span class="at">color =</span> <span class="st">&quot;goldenrod4&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-28"><a href="exporation.html#cb52-28" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb52-29"><a href="exporation.html#cb52-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Some sectors have seasonal employment, othes trend, others both.&quot;</span>)</span></code></pre></div>
<p><img src="time-series_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>Incidentally, <span class="math inline">\(\rho\)</span> is related to the slope of the linear regression line: <span class="math inline">\(\beta_1 = \frac{\sigma_{XY}}{\sigma_X^2} = \rho \frac{\sigma_Y}{\sigma_X}\)</span>.<a href="exporation.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="toolbox.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["time-series.pdf", "time-series.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
